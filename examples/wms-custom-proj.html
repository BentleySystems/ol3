<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <link rel="stylesheet" href="../css/ol.css" type="text/css">
    <link rel="stylesheet" href="../resources/bootstrap/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="../resources/layout.css" type="text/css">
    <link rel="stylesheet" href="../resources/bootstrap/css/bootstrap-responsive.min.css" type="text/css">
    <title>Tiled WMS with custom projection example</title>
  </head>
  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="./"><img src="../resources/logo.png"> OpenLayers 3 Examples</a>
        </div>
      </div>
    </div>

    <div class="container-fluid">

      <div class="row-fluid">
        <div class="span12">
          <div id="map" class="map"></div>
        </div>
      </div>

      <div class="row-fluid">

        <div class="span12">
          <h4 id="title">Tiled WMS with custom projection example</h4>
          <p id="shortdesc">Example of two tiled WMS layers (Pixelmap 1:1'000'000 and national parks) using the projection EPSG:21781.</p>
          <div id="docs">
            <p>See the <a href="wms-custom-proj.js" target="_blank">wms-custom-proj.js source</a> to see how this is done.</p>
          </div>
          <div id="tags">wms, tile, tilelayer, projection</div>
        </div>

      </div>

    </div>
    <!--
    Transform functions script block downloaded from
    http://www.swisstopo.admin.ch/internet/swisstopo/en/home/products/software/products/skripts.html
    -->
    <script language="Javascript">

    // Convert WGS lat/long (° dec) to CH y
    function WGStoCHy(lat, lng) {

      // Converts degrees dec to sex
      lat = DECtoSEX(lat);
      lng = DECtoSEX(lng);

      // Converts degrees to seconds (sex)
      lat = DEGtoSEC(lat);
      lng = DEGtoSEC(lng);
  
      // Axiliary values (% Bern)
      var lat_aux = (lat - 169028.66)/10000;
      var lng_aux = (lng - 26782.5)/10000;
  
      // Process Y
      y = 600072.37 
         + 211455.93 * lng_aux 
         -  10938.51 * lng_aux * lat_aux
         -      0.36 * lng_aux * Math.pow(lat_aux,2)
         -     44.54 * Math.pow(lng_aux,3);
     
      return y;
    }

    // Convert WGS lat/long (° dec) to CH x
    function WGStoCHx(lat, lng) {
  
      // Converts degrees dec to sex
      lat = DECtoSEX(lat);
      lng = DECtoSEX(lng);
  
      // Converts degrees to seconds (sex)
      lat = DEGtoSEC(lat);
      lng = DEGtoSEC(lng);
  
      // Axiliary values (% Bern)
      var lat_aux = (lat - 169028.66)/10000;
      var lng_aux = (lng - 26782.5)/10000;

      // Process X
      x = 200147.07
         + 308807.95 * lat_aux 
         +   3745.25 * Math.pow(lng_aux,2)
         +     76.63 * Math.pow(lat_aux,2)
         -    194.56 * Math.pow(lng_aux,2) * lat_aux
         +    119.79 * Math.pow(lat_aux,3);
 
      return x;
  
    }


    // Convert CH y/x to WGS lat
    function CHtoWGSlat(y, x) {

      // Converts militar to civil and  to unit = 1000km
      // Axiliary values (% Bern)
      var y_aux = (y - 600000)/1000000;
      var x_aux = (x - 200000)/1000000;
  
      // Process lat
      lat = 16.9023892
           +  3.238272 * x_aux
           -  0.270978 * Math.pow(y_aux,2)
           -  0.002528 * Math.pow(x_aux,2)
           -  0.0447   * Math.pow(y_aux,2) * x_aux
           -  0.0140   * Math.pow(x_aux,3);
    
      // Unit 10000" to 1 " and converts seconds to degrees (dec)
      lat = lat * 100/36;
  
      return lat;
  
    }

    // Convert CH y/x to WGS long
    function CHtoWGSlng(y, x) {

      // Converts militar to civil and  to unit = 1000km
      // Axiliary values (% Bern)
      var y_aux = (y - 600000)/1000000;
      var x_aux = (x - 200000)/1000000;
  
      // Process long
      lng = 2.6779094
            + 4.728982 * y_aux
            + 0.791484 * y_aux * x_aux
            + 0.1306   * y_aux * Math.pow(x_aux,2)
            - 0.0436   * Math.pow(y_aux,3);
     
      // Unit 10000" to 1 " and converts seconds to degrees (dec)
      lng = lng * 100/36;
     
      return lng;
  
    }


    // Convert SEX DMS angle to DEC
    function SEXtoDEC(angle) {

      // Extract DMS
      var deg = parseInt( angle );
      var min = parseInt( (angle-deg)*100 );
      var sec = (((angle-deg)*100) - min) * 100;
  
      // Result in degrees sex (dd.mmss)
      return deg + (sec/60 + min)/60;
  
    }

    // Convert DEC angle to SEX DMS
    function DECtoSEX(angle) {

      // Extract DMS
      var deg = parseInt( angle );
      var min = parseInt( (angle-deg)*60 );
      var sec =  (((angle-deg)*60)-min)*60;   

      // Result in degrees sex (dd.mmss)
      return deg + min/100 + sec/10000;
  
    }

    // Convert Degrees angle to seconds
    function DEGtoSEC(angle) {

      // Extract DMS
      var deg = parseInt( angle );
      var min = parseInt( (angle-deg)*100 );
      var sec = (((angle-deg)*100) - min) * 100;
  
      // Avoid rounding problems with seconds=0
      var parts = String(angle).split(".");
      if (parts.length == 2 && parts[1].length == 2) {
        min = Number(parts[1]);
        sec = 0;
      }
  
      // Result in degrees sex (dd.mmss)
      return sec + min*60 + deg*3600;
  
    }

    </script>
    <script src="jquery.min.js" type="text/javascript"></script>
    <script src="../resources/example-behaviour.js" type="text/javascript"></script>
    <script src="loader.js?id=wms-custom-proj" type="text/javascript"></script>

  </body>
</html>
